@model DAL.ViewModels.Identity.RegisterVM
@{
    ViewData["Title"] = "Register";
    ViewData["Subtitle"] = "Create your MovieMart account";
    Layout = "~/Areas/Identity/Views/Shared/_Layout.cshtml";

}

<div class="auth-content">
    <form asp-area="Identity" asp-controller="Account" asp-action="Register" method="post" class="needs-validation" novalidate>
        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

        <div class="row g-3">
            <div class="col-md-6">
                <div class="form-floating mb-3">
                    <input asp-for="FirstName" class="form-control" placeholder="First Name" required />
                    <label asp-for="FirstName"></label>
                    <span asp-validation-for="FirstName" class="text-danger small"></span>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-floating mb-3">
                    <input asp-for="LastName" class="form-control" placeholder="Last Name" required />
                    <label asp-for="LastName"></label>
                    <span asp-validation-for="LastName" class="text-danger small"></span>
                </div>
            </div>
        </div>

        <div class="form-floating mb-3">
            <input asp-for="Email" class="form-control" placeholder="Email Address" required />
            <label asp-for="Email"></label>
            <span asp-validation-for="Email" class="text-danger small"></span>
        </div>

        <div class="row g-3">
            <div class="col-md-6">
                <div class="form-floating mb-3">
                    <input asp-for="Password" type="password" class="form-control" placeholder="Password" required />
                    <label asp-for="Password"></label>
                    <span asp-validation-for="Password" class="text-danger small"></span>
                    <div class="password-strength mt-2">
                        <div class="progress" style="height: 4px;">
                            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                        </div>
                        <small class="text-muted">Password strength</small>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-floating mb-3">
                    <input asp-for="ConfirmPassword" type="password" class="form-control" placeholder="Confirm Password" required />
                    <label asp-for="ConfirmPassword"></label>
                    <span asp-validation-for="ConfirmPassword" class="text-danger small"></span>
                </div>
            </div>
        </div>

        <div class="row g-3">
            <div class="col-md-6">
                <div class="form-floating mb-3">
                    <input asp-for="BirthDay" type="date" class="form-control" placeholder="Birth Date" />
                    <label asp-for="BirthDay"></label>
                    <span asp-validation-for="BirthDay" class="text-danger small"></span>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-floating mb-3">
                    <input asp-for="Address" class="form-control" placeholder="Address" />
                    <label asp-for="Address"></label>
                    <span asp-validation-for="Address" class="text-danger small"></span>
                </div>
            </div>
        </div>

        <div class="form-check mb-4">
            <input class="form-check-input" type="checkbox" id="termsCheck" required>
            <label class="form-check-label small" for="termsCheck">
                I agree to the <a href="#" class="auth-link">Terms of Service</a> and <a href="#" class="auth-link">Privacy Policy</a>
            </label>
        </div>

        <button type="submit" class="btn btn-auth w-100 py-3 mb-3">
            <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            <span class="btn-text">Create Account</span>
        </button>

        <div class="divider">OR</div>
        <div class="social-auth">
            <a href="#" class="social-btn bg-google">
                <i class="bi bi-google"></i>
            </a>
            <a href="#" class="social-btn bg-facebook">
                <i class="bi bi-facebook"></i>
            </a>
            <a href="#" class="social-btn bg-twitter">
                <i class="bi bi-twitter-x"></i>
            </a>
        </div>
    </form>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        $(document).ready(function() {
            $('#Password').on('input', function() {
                var password = $(this).val();
                var strength = 0;

                if (password.length > 0) strength += 1;
                if (password.length >= 8) strength += 1;
                if (password.match(/[a-z]/)) strength += 1;
                if (password.match(/[A-Z]/)) strength += 1;
                if (password.match(/[0-9]/)) strength += 1;
                if (password.match(/[^a-zA-Z0-9]/)) strength += 1;

                var width = (strength / 6) * 100;
                var color = 'bg-danger';

                if (strength > 3) color = 'bg-warning';
                if (strength > 4) color = 'bg-success';

                $('.progress-bar').css('width', width + '%').removeClass('bg-danger bg-warning bg-success').addClass(color);
            });

            $('form').on('submit', function() {
                $(this).find('.spinner-border').removeClass('d-none');
                $(this).find('.btn-text').text('Creating Account...');
                $(this).find('button[type="submit"]').prop('disabled', true);
            });

            $('#Email').on('blur', function() {
                var email = $(this).val();
                if (email) {
                    $.get('/Identity/Account/CheckEmail', { email: email }, function(data) {
                        if (data.isTaken) {
                            $('#Email').addClass('is-invalid');
                            $('span[data-valmsg-for="Email"]').text('This email is already registered');
                        }
                    });
                }
            });
        });
    </script>
}